<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HKDSE Physics: Photoelectric Effect Lab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400;700&display=swap');
        
        body { font-family: 'Inter', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Custom Range Slider Styling */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #ffffff;
            cursor: pointer;
            margin-top: -8px; 
            box-shadow: 0 0 10px rgba(255,255,255,0.5);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #4B5563;
            border-radius: 2px;
        }
        
        .glass-panel {
            background: rgba(31, 41, 55, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Ammeter Needle Animation */
        .needle {
            transition: transform 0.2s cubic-bezier(0.4, 2.08, 0.55, 0.44);
            transform-origin: bottom center;
        }
    </style>
</head>
<body class="bg-slate-900 text-white min-h-screen flex flex-col">

    <header class="bg-slate-800 border-b border-slate-700 shadow-lg z-10">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <i class="fa-solid fa-atom text-cyan-400 text-2xl"></i>
                <div>
                    <h1 class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-cyan-400 to-blue-500">
                        HKDSE Physics Lab
                    </h1>
                    <p class="text-xs text-slate-400">Photoelectric Effect Simulation</p>
                </div>
            </div>
            <div class="hidden md:block bg-slate-900 px-4 py-2 rounded-lg border border-slate-700">
                <span class="text-cyan-400 font-mono text-sm">Einstein's Equation: </span>
                <span class="text-white font-mono text-sm ml-2">KE<sub>max</sub> = hf - Φ</span>
            </div>
        </div>
    </header>

    <main class="flex-grow container mx-auto px-4 py-6 gap-6 grid grid-cols-1 lg:grid-cols-12">
        
        <div class="lg:col-span-8 flex flex-col gap-4">
            <div class="glass-panel rounded-2xl p-1 relative shadow-2xl shadow-cyan-900/20">
                <div class="absolute top-4 left-4 z-10 bg-black/50 px-3 py-1 rounded text-xs text-cyan-300 font-mono">
                    <i class="fa-solid fa-video mr-2"></i>Vacuum Chamber View
                </div>
                <canvas id="simCanvas" class="w-full h-[400px] bg-black rounded-xl cursor-crosshair"></canvas>
            </div>

            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="bg-slate-800 p-3 rounded-xl border border-slate-700">
                    <p class="text-xs text-slate-400 uppercase tracking-wider">Photon Energy (E)</p>
                    <p class="text-xl font-mono font-bold text-cyan-400" id="disp-photon-e">0.00 eV</p>
                </div>
                <div class="bg-slate-800 p-3 rounded-xl border border-slate-700">
                    <p class="text-xs text-slate-400 uppercase tracking-wider">Work Function (Φ)</p>
                    <p class="text-xl font-mono font-bold text-yellow-400" id="disp-work-func">2.28 eV</p>
                </div>
                <div class="bg-slate-800 p-3 rounded-xl border border-slate-700">
                    <p class="text-xs text-slate-400 uppercase tracking-wider">Max KE (K<sub>max</sub>)</p>
                    <p class="text-xl font-mono font-bold text-green-400" id="disp-kemax">0.00 eV</p>
                </div>
                <div class="bg-slate-800 p-3 rounded-xl border border-slate-700">
                    <p class="text-xs text-slate-400 uppercase tracking-wider">Max Velocity</p>
                    <p class="text-xl font-mono font-bold text-pink-400" id="disp-velocity">0 km/s</p>
                </div>
            </div>
        </div>

        <div class="lg:col-span-4 flex flex-col gap-4">
            
            <div class="glass-panel rounded-2xl p-6 flex flex-col gap-6">
                <h2 class="text-lg font-semibold border-b border-slate-600 pb-2 flex items-center gap-2">
                    <i class="fa-solid fa-sliders text-cyan-400"></i> Experiment Controls
                </h2>

                <div>
                    <label class="block text-sm text-slate-300 mb-2">Target Metal (Cathode)</label>
                    <select id="metalSelect" class="w-full bg-slate-900 border border-slate-600 rounded-lg p-2.5 text-white focus:ring-2 focus:ring-cyan-500 outline-none">
                        <option value="2.28">Sodium (Na) - Φ = 2.28 eV</option>
                        <option value="4.3">Zinc (Zn) - Φ = 4.30 eV</option>
                        <option value="4.7">Copper (Cu) - Φ = 4.70 eV</option>
                        <option value="6.35">Platinum (Pt) - Φ = 6.35 eV</option>
                    </select>
                </div>

                <div>
                    <div class="flex justify-between mb-1">
                        <label class="text-sm text-slate-300">Wavelength (λ)</label>
                        <span class="font-mono text-cyan-400" id="val-lambda">400 nm</span>
                    </div>
                    <input type="range" id="slider-lambda" min="200" max="800" value="400" class="w-full h-2 rounded-lg appearance-none cursor-pointer">
                    <div class="flex justify-between text-[10px] text-slate-500 mt-1">
                        <span>UV</span><span>Visible</span><span>IR</span>
                    </div>
                </div>

                <div>
                    <div class="flex justify-between mb-1">
                        <label class="text-sm text-slate-300">Light Intensity</label>
                        <span class="font-mono text-cyan-400" id="val-intensity">50%</span>
                    </div>
                    <input type="range" id="slider-intensity" min="0" max="100" value="50" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
                </div>

                <div>
                    <div class="flex justify-between mb-1">
                        <label class="text-sm text-slate-300">Voltage (V)</label>
                        <span class="font-mono text-cyan-400" id="val-voltage">0.00 V</span>
                    </div>
                    <input type="range" id="slider-voltage" min="-5.00" max="5.00" step="0.10" value="0" class="w-full h-2 bg-gradient-to-r from-red-500 via-slate-600 to-green-500 rounded-lg appearance-none cursor-pointer">
                    <div class="flex justify-between text-[10px] text-slate-500 mt-1">
                        <span class="text-red-400">Retarding (-)</span>
                        <span class="text-green-400">Accelerating (+)</span>
                    </div>
                </div>
            </div>

	<div class="bg-slate-200 rounded-2xl p-4 flex flex-col items-center shadow-inner relative">
                <div class="text-slate-600 font-bold text-xs uppercase tracking-wider mb-2 z-10">
                    Galvanometer (Current)
                </div>
                
                <div class="relative w-full h-24 overflow-hidden">
                    <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-48 h-24 border-t-[20px] border-slate-400 rounded-t-full"></div>
                    
                    <div id="ammeter-needle" class="needle absolute bottom-1 left-1/2 w-1 h-20 bg-red-600 origin-bottom -translate-x-1/2 rotate-[-45deg] z-0"></div>
                    
                    <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-4 h-4 bg-slate-800 rounded-full z-10"></div>
                </div>
            </div>

        </div>
    </main>

    <section class="bg-slate-800 border-t border-slate-700 py-6">
        <div class="container mx-auto px-4">
            <h3 class="text-cyan-400 font-bold mb-2"><i class="fa-solid fa-chalkboard-user mr-2"></i>Teacher's Note</h3>
            <div class="bg-slate-900/50 p-4 rounded-lg text-slate-300 text-sm leading-relaxed">
                <p class="mb-2">
                    The photoelectric effect demonstrates the particle nature of light. When a photon with energy 
                    <span class="text-yellow-300 font-mono">E = hf</span> hits a metal surface, it transfers energy to an electron.
                </p>
                <ul class="list-disc list-inside space-y-1 ml-2">
                    <li>If <span class="text-yellow-300 font-mono">E < Φ</span> (Work Function), the electron cannot escape. Current is zero.</li>
                    <li>If <span class="text-yellow-300 font-mono">E > Φ</span>, the electron escapes with Kinetic Energy: <span class="text-green-300 font-mono">KE<sub>max</sub> = hf - Φ</span>.</li>
                    <li>
                        The <strong>Stopping Potential (Vs)</strong> is the negative voltage required to stop the most energetic electrons. 
                        At this point, <span class="text-red-300 font-mono">KE<sub>max</sub> = e × V<sub>s</sub></span>.
                    </li>
                </ul>
            </div>
        </div>
    </section>

    <script>
        // --- Physics Constants & State ---
        const CONSTANTS = {
            hc: 1240, // eV * nm (Simplified for easy calculation)
            mass_e: 9.11e-31, // kg
            e: 1.602e-19 // C
        };

        let state = {
            lambda: 400,      // nm
            intensity: 50,    // %
            workFunction: 2.28, // eV
            voltage: 0.0,     // V
            photonEnergy: 0,  // eV
            keMax: 0,         // eV
            isEmitting: false
        };

        // --- Elements ---
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        
        // Sliders & Inputs
        const sLambda = document.getElementById('slider-lambda');
        const sIntensity = document.getElementById('slider-intensity');
        const sVoltage = document.getElementById('slider-voltage');
        const sMetal = document.getElementById('metalSelect');

        // Displays
        const dLambda = document.getElementById('val-lambda');
        const dIntensity = document.getElementById('val-intensity');
        const dVoltage = document.getElementById('val-voltage');
        
        const dispPhotonE = document.getElementById('disp-photon-e');
        const dispWorkFunc = document.getElementById('disp-work-func');
        const dispKeMax = document.getElementById('disp-kemax');
        const dispVelocity = document.getElementById('disp-velocity');
        const ammeterNeedle = document.getElementById('ammeter-needle');

        // --- Physics Engine Helpers ---

        function calculatePhysics() {
            // 1. Photon Energy E = 1240 / lambda
            state.photonEnergy = CONSTANTS.hc / state.lambda;
            
            // 2. Max Kinetic Energy = E - Phi
            let ke = state.photonEnergy - state.workFunction;
            state.keMax = ke > 0 ? ke : 0;
            state.isEmitting = ke > 0;

            // 3. Velocity (Real physics for display, scaled for canvas)
            // v = sqrt(2 * KE_joules / m)
            if (state.isEmitting) {
                const keJoules = state.keMax * CONSTANTS.e;
                const velocity = Math.sqrt((2 * keJoules) / CONSTANTS.mass_e);
                state.velocityReal = velocity; // m/s
            } else {
                state.velocityReal = 0;
            }
            
            updateUI();
        }

        function wavelengthToColor(wavelength) {
            let r, g, b;
            if (wavelength >= 380 && wavelength < 440) {
                r = -(wavelength - 440) / (440 - 380); g = 0; b = 1;
            } else if (wavelength >= 440 && wavelength < 490) {
                r = 0; g = (wavelength - 440) / (490 - 440); b = 1;
            } else if (wavelength >= 490 && wavelength < 510) {
                r = 0; g = 1; b = -(wavelength - 510) / (510 - 490);
            } else if (wavelength >= 510 && wavelength < 580) {
                r = (wavelength - 510) / (580 - 510); g = 1; b = 0;
            } else if (wavelength >= 580 && wavelength < 645) {
                r = 1; g = -(wavelength - 645) / (645 - 580); b = 0;
            } else if (wavelength >= 645 && wavelength < 781) {
                r = 1; g = 0; b = 0;
            } else {
                r = 0; g = 0; b = 0;
            }

            // Intensity fade for UV/IR
            let factor = 1;
            if (wavelength < 420) factor = 0.3 + 0.7 * (wavelength - 380) / (420 - 380);
            if (wavelength > 700) factor = 0.3 + 0.7 * (780 - wavelength) / (780 - 700);
            if (wavelength < 380) { r=0.5; g=0; b=0.5; factor=0.5; } // Deep UV representation
            if (wavelength > 780) { r=0.3; g=0; b=0; factor=0.5; } // Deep IR representation

            return `rgba(${r * 255},${g * 255},${b * 255}, ${factor})`;
        }

        function updateUI() {
            // Text Updates
            dLambda.textContent = state.lambda + " nm";
            dIntensity.textContent = state.intensity + "%";
            dVoltage.textContent = (state.voltage > 0 ? "+" : "") + parseFloat(state.voltage).toFixed(2) + " V";

            dispPhotonE.textContent = state.photonEnergy.toFixed(2) + " eV";
            dispWorkFunc.textContent = state.workFunction.toFixed(2) + " eV";
            dispKeMax.textContent = state.keMax.toFixed(2) + " eV";
            dispVelocity.textContent = (state.velocityReal / 1000).toFixed(0) + " km/s";

            // Slider Background Gradient Logic
            const color = wavelengthToColor(state.lambda);
            sLambda.style.background = `linear-gradient(90deg, #333, ${color}, #333)`;
        }

        // --- Animation System ---

        let photons = [];
        let electrons = [];
        let currentFlow = 0; // For Ammeter

        class Photon {
            constructor() {
                this.x = 50; // Source X
                this.y = Math.random() * 200 + 100; // Random height
                this.speed = 5;
                this.color = wavelengthToColor(state.lambda);
                this.wavelength = state.lambda;
            }
            
            update() {
                this.x += this.speed;
                // Wiggle effect for wave nature
                this.y += Math.sin(this.x / 10) * 0.5; 
            }
            
            draw() {
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, 3, 0, Math.PI * 2);
                ctx.fill();
                
                // Optional: Draw wave trail
                ctx.strokeStyle = this.color;
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(this.x - 10, this.y);
                ctx.lineTo(this.x, this.y);
                ctx.stroke();
            }
        }

        class Electron {
            constructor(y, keMax_eV) {
                this.x = 250; // Emitter Plate Position
                this.y = y;
                this.ke_eV = keMax_eV; // Initial Energy in eV
                
                // Visual Speed Scaling: map 0-5eV to 0-8 pixels/frame
                // Base speed comes from initial KE
                this.vx = Math.sqrt(this.ke_eV) * 2.5; 
                
                // Spread emission slightly
                this.vy = (Math.random() - 0.5) * 0.5; 
                
                this.active = true;
                this.color = "#aaaaaa";
            }

            update() {
                // Apply Voltage Force
                // Force is proportional to Voltage. 
                // Acceleration = Force / Mass. 
                // Simulating this: change vx based on voltage.
                
                const acceleration = state.voltage * 0.15; // Arbitrary scaling for visual feel
                this.vx += acceleration;

                this.x += this.vx;
                this.y += this.vy;

                // 1. Hit Collector (Success)
                if (this.x > 650) {
                    this.active = false;
                    currentFlow++;
                }

                // 2. Turned Back (Retarding potential too strong)
                if (this.vx < 0 && this.x < 250) {
                    this.x = 250;
                    this.active = false; // Absorbed back into emitter
                }
            }

            draw() {
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, 2.5, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function resizeCanvas() {
            canvas.width = canvas.parentElement.clientWidth;
            canvas.height = canvas.parentElement.clientHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // --- Main Loop ---

        function animate() {
            // Clear Canvas
            ctx.fillStyle = "black";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw Apparatus
            // Source Light
            ctx.fillStyle = "#333";
            ctx.fillRect(10, 50, 40, 300);
            
            // Emitter Plate (Cathode) - Left
            ctx.fillStyle = "#555"; // Zinc/Metal color
            ctx.fillRect(240, 50, 10, 300); // Plate
            ctx.strokeStyle = "#777";
            ctx.beginPath(); ctx.moveTo(245, 200); ctx.lineTo(245, 400); ctx.stroke(); // Wire
            
            // Collector Plate (Anode) - Right
            ctx.fillStyle = "#555";
            ctx.fillRect(650, 50, 10, 300);
            ctx.strokeStyle = "#777";
            ctx.beginPath(); ctx.moveTo(655, 200); ctx.lineTo(655, 400); ctx.stroke(); // Wire

            // Voltage Field Visual
            if (state.voltage !== 0) {
                ctx.fillStyle = state.voltage > 0 ? "rgba(0, 255, 0, 0.05)" : "rgba(255, 0, 0, 0.05)";
                ctx.fillRect(250, 50, 400, 300);
                ctx.fillStyle = "white";
                ctx.font = "12px monospace";
                ctx.fillText(state.voltage > 0 ? "E-Field --> (Accelerating)" : "E-Field <-- (Retarding)", 350, 380);
            }

            // Spawn Photons based on Intensity
            if (Math.random() * 100 < state.intensity / 5) {
                photons.push(new Photon());
            }

            // Update Photons
            for (let i = photons.length - 1; i >= 0; i--) {
                let p = photons[i];
                p.update();
                p.draw();

                // Hit Emitter Plate logic
                if (p.x >= 240) {
                    // Physics Check: Does it eject an electron?
                    if (state.isEmitting) {
                        electrons.push(new Electron(p.y, state.keMax));
                    }
                    photons.splice(i, 1); // Photon absorbed
                }
            }

            // Update Electrons
            for (let i = electrons.length - 1; i >= 0; i--) {
                let e = electrons[i];
                e.update();
                e.draw();
                if (!e.active) electrons.splice(i, 1);
            }

            // Update Ammeter (Smoothed)
            // Map currentFlow count to angle (-45 to 45)
            let targetAngle = -45;
            if (currentFlow > 0) {
                // Max current scaling
                let scale = Math.min(currentFlow * 2, 90); 
                targetAngle = -45 + scale;
            }
            // Apply rotation
            ammeterNeedle.style.transform = `translateX(-50%) rotate(${targetAngle}deg)`;
            
            // Decay current flow (so it drops if intensity drops)
            currentFlow *= 0.9; 

            requestAnimationFrame(animate);
        }

        // --- Event Listeners ---
        
        sLambda.addEventListener('input', (e) => {
            state.lambda = parseInt(e.target.value);
            calculatePhysics();
        });

        sIntensity.addEventListener('input', (e) => {
            state.intensity = parseInt(e.target.value);
            updateUI();
        });

        sMetal.addEventListener('change', (e) => {
            state.workFunction = parseFloat(e.target.value);
            calculatePhysics();
        });

        sVoltage.addEventListener('input', (e) => {
            state.voltage = parseFloat(e.target.value);
            updateUI();
        });

        // Init
        calculatePhysics();
        animate();

    </script>
    
    <!-- Footer -->
    <footer class="bg-slate-900 text-slate-400 py-8 text-center">
        <div class="max-w-7xl mx-auto px-4">
            <p class="text-sm italic mb-2">But God made the earth by his power;<br>
            he founded the world by his wisdom<br>
            and stretched out the heavens by his understanding.</p>
            <p class="text-sm mb-2">Jeremiah 10:12</p>
            <p class="text-xs mb-2 mt-4">「耶和華用能力創造大地，用智慧建立世界，用聰明鋪張穹蒼。」</p>
            <p class="text-xs mb-4">耶利米書 10:12</p>
            <p class="text-xs mt-4 pt-4 border-t border-slate-700">@ 2025 Generated by Gemini Pro 3.0  Prepared by SF Lau</p>
        </div>
    </footer>
</body>
</html>