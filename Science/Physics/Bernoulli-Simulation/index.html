<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bernoulli's Principle: Venturi Effect</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom range slider styling for better cross-browser look */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #3b82f6; /* Tailwind blue-500 */
            cursor: pointer;
            margin-top: -6px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #cbd5e1; /* Tailwind slate-300 */
            border-radius: 2px;
        }
        input[type=range]:focus {
            outline: none;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans selection:bg-blue-200">

    <!-- Main Container -->
    <div class="max-w-7xl mx-auto p-4 md:p-6 lg:p-8">
        
        <!-- Header -->
        <header class="mb-6 border-b border-slate-200 pb-4">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900">Bernoulli's Principle: <span class="text-blue-600">Venturi Effect</span></h1>
            <p class="text-slate-500 mt-2 text-lg">Interactive simulation for Secondary 2 Physics</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Left Column: Controls & Data -->
            <div class="space-y-6">
                
                <!-- Controls Card -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                    <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
                        <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path></svg>
                        Experiment Controls
                    </h2>
                    
                    <!-- Slider: Inlet Diameter -->
                    <div class="mb-5">
                        <div class="flex justify-between mb-1">
                            <label class="text-sm font-medium text-slate-700">Inlet Diameter ($D_1$)</label>
                            <span id="val-d1" class="text-sm font-bold text-blue-600">8.0 cm</span>
                        </div>
                        <input type="range" id="input-d1" min="4" max="10" step="0.1" value="8" class="w-full">
                    </div>

                    <!-- Slider: Throat Diameter -->
                    <div class="mb-5">
                        <div class="flex justify-between mb-1">
                            <label class="text-sm font-medium text-slate-700">Throat Diameter ($D_2$)</label>
                            <span id="val-d2" class="text-sm font-bold text-red-600">4.0 cm</span>
                        </div>
                        <input type="range" id="input-d2" min="1" max="8" step="0.1" value="4" class="w-full">
                        <p class="text-xs text-slate-400 mt-1">Must be smaller than Inlet</p>
                    </div>

                    <!-- Slider: Flow Rate -->
                    <div>
                        <div class="flex justify-between mb-1">
                            <label class="text-sm font-medium text-slate-700">Flow Rate ($Q$)</label>
                            <span id="val-flow" class="text-sm font-bold text-green-600">5.0 L/s</span>
                        </div>
                        <input type="range" id="input-flow" min="1" max="10" step="0.1" value="5" class="w-full">
                    </div>
                </div>

                <!-- Live Data Card -->
                <div class="bg-slate-900 text-white p-6 rounded-xl shadow-lg">
                    <h2 class="text-xl font-semibold mb-4 text-blue-300">Real-time Data</h2>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <!-- Section 1 Data -->
                        <div class="space-y-2 border-r border-slate-700 pr-4">
                            <h3 class="text-sm uppercase tracking-wider text-slate-400 font-bold">Section 1 (Wide)</h3>
                            <div class="flex flex-col">
                                <span class="text-xs text-slate-400">Velocity ($v_1$)</span>
                                <span id="out-v1" class="text-2xl font-mono text-blue-400">0.00 m/s</span>
                            </div>
                            <div class="flex flex-col">
                                <span class="text-xs text-slate-400">Pressure Head ($h_1$)</span>
                                <span id="out-p1" class="text-2xl font-mono text-blue-200">0.00 m</span>
                            </div>
                        </div>

                        <!-- Section 2 Data -->
                        <div class="space-y-2 pl-2">
                            <h3 class="text-sm uppercase tracking-wider text-slate-400 font-bold">Section 2 (Throat)</h3>
                            <div class="flex flex-col">
                                <span class="text-xs text-slate-400">Velocity ($v_2$)</span>
                                <span id="out-v2" class="text-2xl font-mono text-red-400">0.00 m/s</span>
                            </div>
                            <div class="flex flex-col">
                                <span class="text-xs text-slate-400">Pressure Head ($h_2$)</span>
                                <span id="out-p2" class="text-2xl font-mono text-red-200">0.00 m</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Formulas -->
                <div class="bg-blue-50 border border-blue-100 p-4 rounded-lg">
                    <h3 class="font-bold text-blue-800 mb-2">Key Formulas</h3>
                    <p class="text-sm text-blue-900 mb-2 font-mono bg-white p-2 rounded border border-blue-200">
                        A₁v₁ = A₂v₂
                    </p>
                    <p class="text-xs text-blue-600 mb-3">Continuity Equation: Area × Velocity is constant.</p>
                    <p class="text-sm text-blue-900 mb-2 font-mono bg-white p-2 rounded border border-blue-200">
                        P + ½ρv² = Constant
                    </p>
                    <p class="text-xs text-blue-600">Bernoulli's Equation: As speed increases, pressure decreases.</p>
                </div>

            </div>

            <!-- Right Column: Simulation & Context -->
            <div class="lg:col-span-2 flex flex-col gap-6">
                
                <!-- Canvas Container -->
                <div class="bg-white rounded-xl shadow-md border border-slate-200 overflow-hidden relative">
                    <div class="absolute top-4 left-4 bg-white/90 backdrop-blur px-3 py-1 rounded text-xs font-bold text-slate-500 z-10 border border-slate-200">
                        Simulation View
                    </div>
                    <!-- The Canvas -->
                    <canvas id="simCanvas" class="w-full h-[400px] bg-sky-50 block cursor-crosshair"></canvas>
                    
                    <!-- Legend -->
                    <div class="bg-slate-50 border-t border-slate-200 p-3 flex gap-6 text-sm justify-center">
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 rounded-full bg-blue-500"></div>
                            <span>Slow Fluid</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 rounded-full bg-red-500"></div>
                            <span>Fast Fluid</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-8 border border-slate-400 bg-sky-200"></div>
                            <span>Manometer (Pressure)</span>
                        </div>
                    </div>
                </div>

                <!-- Teacher's Note -->
                <div class="bg-amber-50 border border-amber-200 rounded-xl p-6">
                    <h3 class="text-lg font-bold text-amber-800 mb-2 flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        Teacher's Observation
                    </h3>
                    <p class="text-amber-900 leading-relaxed">
                        Notice the relationship between the <strong>speed of the particles</strong> and the <strong>height of the water</strong> in the vertical tubes. 
                    </p>
                    <ul class="list-disc list-inside mt-3 text-amber-800 space-y-1">
                        <li>In the <strong>wide section</strong>, the water moves slowly, but the pressure is <span class="font-bold">high</span> (tall water column).</li>
                        <li>In the <strong>narrow throat</strong>, the water speeds up (to conserve mass flow), but the pressure <span class="font-bold">drops</span> (short water column).</li>
                    </ul>
                    <p class="mt-3 text-sm text-amber-700 italic">
                        This demonstrates the <strong>Conservation of Energy</strong>: The fluid trades pressure energy for kinetic (motion) energy.
                    </p>
                </div>

            </div>
        </div>
    </div>

    <!-- Application Logic -->
    <script>
        // --- Configuration & Constants ---
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        
        // Physics constants (arbitrary scale for visualization)
        const RHO = 1.0; // Fluid density (simplified)
        const BASE_PRESSURE_HEAD = 150; // Base pressure height in pixels to keep visuals on screen
        const PIXELS_PER_METER = 20; // Scale factor
        
        // UI Elements
        const ui = {
            d1: document.getElementById('input-d1'),
            d2: document.getElementById('input-d2'),
            flow: document.getElementById('input-flow'),
            valD1: document.getElementById('val-d1'),
            valD2: document.getElementById('val-d2'),
            valFlow: document.getElementById('val-flow'),
            outV1: document.getElementById('out-v1'),
            outP1: document.getElementById('out-p1'),
            outV2: document.getElementById('out-v2'),
            outP2: document.getElementById('out-p2'),
        };

        // State variables
        let state = {
            d1: 8.0,      // Inlet diameter
            d2: 4.0,      // Throat diameter
            flow: 5.0,    // Flow rate
            v1: 0,
            v2: 0,
            p1: 0,        // Pressure head 1 (visual height)
            p2: 0,        // Pressure head 2 (visual height)
            particles: [] // Array to hold particle objects
        };

        // --- Particle System ---
        class Particle {
            constructor() {
                this.reset();
                // Randomize initial x to spread them out
                this.x = Math.random() * canvas.width;
            }

            reset() {
                this.x = -20;
                this.y = (Math.random() - 0.5) * (state.d1 * PIXELS_PER_METER * 0.8); // Stay within pipe
                this.size = Math.random() * 2 + 2;
                this.streamLineOffset = (Math.random() - 0.5) * 0.9; // Value -0.5 to 0.5 relative to pipe height
            }

            update(dt) {
                // Determine current section properties based on X position
                const pipeParams = getPipeDimensionsAtX(this.x);
                
                // Set speed based on current pipe width (v ~ 1/Width for 2D visual approx, or 1/Area for 3D)
                // Using 1/Area logic to match the numbers shown
                // Speed scaling factor for animation smoothness
                const currentV = (state.flow * 20) / pipeParams.area; 
                
                this.x += currentV;

                // Adjust Y to squeeze into throat
                this.y = this.streamLineOffset * pipeParams.height;

                // Reset if off screen
                if (this.x > canvas.width + 20) {
                    this.reset();
                }
            }

            draw() {
                const pipeParams = getPipeDimensionsAtX(this.x);
                // Color shift based on speed: Blue (Slow) -> Red (Fast)
                // Normalize speed for color: typical range 0.5 to 5
                const speedFactor = Math.min(1, Math.max(0, (state.v2 - state.v1) === 0 ? 0 : ((state.flow * 20 / pipeParams.area) - state.v1) / (state.v2 * 1.5)));
                
                const r = Math.floor(59 + (239 - 59) * speedFactor); // From blue-500 to red-500 approx
                const g = Math.floor(130 - 130 * speedFactor);
                const b = Math.floor(246 - 246 * speedFactor);

                ctx.fillStyle = `rgb(${r},${g},${b})`;
                ctx.beginPath();
                ctx.arc(this.x, canvas.height/2 + this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // --- Physics Engine ---
        function updatePhysics() {
            // Get inputs
            state.d1 = parseFloat(ui.d1.value);
            state.d2 = parseFloat(ui.d2.value);
            state.flow = parseFloat(ui.flow.value);

            // Constraint: Throat cannot be larger than Inlet
            if (state.d2 > state.d1) {
                state.d2 = state.d1;
                ui.d2.value = state.d2;
            }

            // Update UI Labels
            ui.valD1.textContent = state.d1.toFixed(1) + " cm";
            ui.valD2.textContent = state.d2.toFixed(1) + " cm";
            ui.valFlow.textContent = state.flow.toFixed(1) + " L/s";

            // 1. Calculate Areas (A = pi * r^2)
            // Scaling for calculation: assume input cm is unit
            const A1 = Math.PI * Math.pow(state.d1 / 2, 2);
            const A2 = Math.PI * Math.pow(state.d2 / 2, 2);

            // 2. Calculate Velocities (v = Q / A)
            // Scale flow to make numbers readable (e.g. 5 L/s -> visual units)
            const speedScale = 10; 
            state.v1 = (state.flow / A1) * speedScale;
            state.v2 = (state.flow / A2) * speedScale;

            // 3. Bernoulli Calculation for Pressure
            // P1 + 0.5 * rho * v1^2 = P2 + 0.5 * rho * v2^2
            // We set a base total head to ensure P is positive for visualization
            const totalHead = BASE_PRESSURE_HEAD + 0.5 * RHO * Math.pow(state.v1 * 0.5, 2) + 100; // +100 static offset
            
            // Calculate dynamic pressure heads (visual height in pixels)
            // Note: v terms are scaled down slightly to make visual height differences less extreme
            state.p1 = totalHead - 0.5 * RHO * Math.pow(state.v1, 2);
            state.p2 = totalHead - 0.5 * RHO * Math.pow(state.v2, 2);

            // Update Text Displays
            ui.outV1.textContent = state.v1.toFixed(2) + " m/s";
            ui.outV2.textContent = state.v2.toFixed(2) + " m/s";
            
            // Show relative pressure (arbitrary units for clarity)
            ui.outP1.textContent = (state.p1 / 20).toFixed(2) + " units";
            ui.outP2.textContent = (state.p2 / 20).toFixed(2) + " units";
        }

        // --- Render Helpers ---
        function getPipeDimensionsAtX(x) {
            const centerY = canvas.height / 2;
            
            // Pipe Geometry Definition
            const inletEnd = canvas.width * 0.3;
            const throatStart = canvas.width * 0.45;
            const throatEnd = canvas.width * 0.65;
            const outletStart = canvas.width * 0.8;

            let d = state.d1;

            if (x < inletEnd) {
                d = state.d1;
            } else if (x >= inletEnd && x < throatStart) {
                // Constricting taper (Linear interpolation)
                const t = (x - inletEnd) / (throatStart - inletEnd);
                d = state.d1 + (state.d2 - state.d1) * easeInOut(t);
            } else if (x >= throatStart && x < throatEnd) {
                // Throat
                d = state.d2;
            } else if (x >= throatEnd && x < outletStart) {
                // Expanding taper
                const t = (x - throatEnd) / (outletStart - throatEnd);
                d = state.d2 + (state.d1 - state.d2) * easeInOut(t);
            } else {
                d = state.d1;
            }

            // Convert diameter cm to pixels
            const height = d * PIXELS_PER_METER;
            const area = Math.PI * Math.pow(d/2, 2);

            return { height, area };
        }

        // Smooth easing function for pipe transitions
        function easeInOut(t) {
            return t < .5 ? 2 * t * t : -1 + (4 - 2 * t) * t;
        }

        // --- Drawing ---
        function drawPipe() {
            const centerY = canvas.height / 2;
            const w = canvas.width;
            
            ctx.fillStyle = '#e0f2fe'; // sky-100
            ctx.strokeStyle = '#334155'; // slate-700
            ctx.lineWidth = 3;

            // Build the top path
            ctx.beginPath();
            ctx.moveTo(0, centerY - getPipeDimensionsAtX(0).height/2);
            
            // Draw top edge with high resolution
            for(let x = 0; x <= w; x+=5) {
                const h = getPipeDimensionsAtX(x).height;
                ctx.lineTo(x, centerY - h/2);
            }
            
            // Draw bottom edge
            for(let x = w; x >= 0; x-=5) {
                const h = getPipeDimensionsAtX(x).height;
                ctx.lineTo(x, centerY + h/2);
            }
            
            ctx.closePath();
            ctx.fill();
            ctx.stroke();

            // Draw Centerline
            ctx.beginPath();
            ctx.strokeStyle = '#94a3b8'; // slate-400
            ctx.setLineDash([5, 5]);
            ctx.lineWidth = 1;
            ctx.moveTo(0, centerY);
            ctx.lineTo(w, centerY);
            ctx.stroke();
            ctx.setLineDash([]);
        }

        function drawManometers() {
            const centerY = canvas.height / 2;
            const pipeWidth = 20; // width of manometer tube
            
            // Position 1: Inlet (Wide)
            const x1 = canvas.width * 0.15; 
            const h1_pipe = getPipeDimensionsAtX(x1).height;
            const y1_base = centerY - h1_pipe/2;
            
            // Position 2: Throat (Narrow)
            const x2 = canvas.width * 0.55;
            const h2_pipe = getPipeDimensionsAtX(x2).height;
            const y2_base = centerY - h2_pipe/2;

            drawSingleManometer(x1, y1_base, state.p1);
            drawSingleManometer(x2, y2_base, state.p2);
        }

        function drawSingleManometer(x, yBase, pressureHeight) {
            const w = 24;
            const maxH = 200; // max tube height drawn

            // Draw Glass Tube
            ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
            ctx.strokeStyle = '#cbd5e1'; // slate-300
            ctx.lineWidth = 2;
            
            ctx.fillRect(x - w/2, yBase - maxH, w, maxH);
            ctx.strokeRect(x - w/2, yBase - maxH, w, maxH);

            // Draw Liquid Column
            // Clamp pressure visual to tube bounds
            let liquidH = Math.max(0, Math.min(maxH - 5, pressureHeight));
            
            ctx.fillStyle = '#0ea5e9'; // sky-500 (Liquid color)
            ctx.beginPath();
            ctx.rect(x - w/2 + 2, yBase - liquidH, w - 4, liquidH);
            ctx.fill();

            // Meniscus
            ctx.beginPath();
            ctx.ellipse(x, yBase - liquidH, (w-4)/2, 3, 0, 0, Math.PI * 2);
            ctx.fillStyle = '#38bdf8'; // Lighter top
            ctx.fill();
        }

        // --- Main Loop ---
        function loop() {
            // Resize canvas if needed
            if (canvas.width !== canvas.clientWidth || canvas.height !== canvas.clientHeight) {
                canvas.width = canvas.clientWidth;
                canvas.height = canvas.clientHeight;
                // Re-init particles on resize to prevent glitch
                state.particles.forEach(p => p.reset());
            }

            // Clear
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Physics
            updatePhysics();

            // Draw Static Elements
            drawPipe();
            
            // Draw Particles
            state.particles.forEach(p => {
                p.update();
                p.draw();
            });

            // Draw Instruments
            drawManometers();

            requestAnimationFrame(loop);
        }

        // --- Initialization ---
        function init() {
            // Create particles
            for(let i=0; i<150; i++) {
                state.particles.push(new Particle());
            }

            // Event Listeners for inputs
            ui.d1.addEventListener('input', () => { updatePhysics(); });
            ui.d2.addEventListener('input', () => { updatePhysics(); });
            ui.flow.addEventListener('input', () => { updatePhysics(); });

            // Start
            loop();
        }

        // Run
        window.onload = init;

    </script>
    
    <!-- Footer -->
    <footer class="bg-slate-900 text-slate-400 py-8 text-center">
        <div class="max-w-7xl mx-auto px-4">
            <p class="text-sm italic mb-2">But God made the earth by his power;<br>
            he founded the world by his wisdom<br>
            and stretched out the heavens by his understanding.</p>
            <p class="text-sm mb-2">Jeremiah 10:12</p>
            <p class="text-xs mb-2 mt-4">「耶和華用能力創造大地，用智慧建立世界，用聰明鋪張穹蒼。」</p>
            <p class="text-xs mb-4">耶利米書 10:12</p>
            <p class="text-xs mt-4 pt-4 border-t border-slate-700">@ 2025 Generated by Gemini Pro 3.0  Prepared by SF Lau</p>
        </div>
    </footer>
</body>
</html>

        <div class="max-w-7xl mx-auto px-4">
            <p class="text-sm italic mb-2">But God made the earth by his power;<br>
            he founded the world by his wisdom<br>
            and stretched out the heavens by his understanding.</p>
            <p class="text-sm mb-2">Jeremiah 10:12</p>
            <p class="text-xs mb-2 mt-4">「耶和華用能力創造大地，用智慧建立世界，用聰明鋪張穹蒼。」</p>
            <p class="text-xs mb-4">耶利米書 10:12</p>
            <p class="text-xs mt-4 pt-4 border-t border-slate-700">@ 2025 Generated by Gemini Pro 3.0  Prepared by SF Lau</p>
        </div>
    </footer>
</body>
</html>

        <div class="max-w-7xl mx-auto px-4">
            <p class="text-sm italic mb-2">But God made the earth by his power;<br>
            he founded the world by his wisdom<br>
            and stretched out the heavens by his understanding.</p>
            <p class="text-sm mb-2">Jeremiah 10:12</p>
            <p class="text-xs mb-2 mt-4">「耶和華用能力創造大地，用智慧建立世界，用聰明鋪張穹蒼。」</p>
            <p class="text-xs mb-4">耶利米書 10:12</p>
            <p class="text-xs mt-4 pt-4 border-t border-slate-700">@ 2025 Generated by Gemini Pro 3.0  Prepared by SF Lau</p>
        </div>
    </footer>
</body>
</html>

        <div class="max-w-7xl mx-auto px-4">
            <p class="text-sm italic mb-2">But God made the earth by his power;<br>
            he founded the world by his wisdom<br>
            and stretched out the heavens by his understanding.</p>
            <p class="text-sm mb-2">Jeremiah 10:12</p>
            <p class="text-xs mb-2 mt-4">「耶和華用能力創造大地，用智慧建立世界，用聰明鋪張穹蒼。」</p>
            <p class="text-xs mb-4">耶利米書 10:12</p>
            <p class="text-xs mt-4 pt-4 border-t border-slate-700">@ 2025 Generated by Gemini Pro 3.0  Prepared by SF Lau</p>
        </div>
    </footer>
</body>
</html>

        <div class="max-w-7xl mx-auto px-4">
            <p class="text-sm italic mb-2">But God made the earth by his power;<br>
            he founded the world by his wisdom<br>
            and stretched out the heavens by his understanding.</p>
            <p class="text-sm mb-2">Jeremiah 10:12</p>
            <p class="text-xs mb-2 mt-4">「耶和華用能力創造大地，用智慧建立世界，用聰明鋪張穹蒼。」</p>
            <p class="text-xs mb-4">耶利米書 10:12</p>
            <p class="text-xs mt-4 pt-4 border-t border-slate-700">@ 2025 Generated by Gemini Pro 3.0  Prepared by SF Lau</p>
        </div>
    </footer>
</body>
</html>
