<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S.2 Electric Circuit Simulator (Ohm's Law)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@500&display=swap');

        body {
            font-family: 'Inter', sans-serif;
        }
        
        .font-mono {
            font-family: 'JetBrains Mono', monospace;
        }

        /* --- Flow Animations --- */
        @keyframes flowForward {
            to { stroke-dashoffset: -40; }
        }
        @keyframes flowBackward {
            to { stroke-dashoffset: 40; }
        }

        .flow-conventional {
            stroke-dasharray: 4 16;
            animation: flowForward 1s linear infinite;
            stroke-linecap: round;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .flow-electron {
            stroke-dasharray: 4 16;
            animation: flowBackward 1s linear infinite;
            stroke-linecap: round;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        /* Active State */
        .circuit-active .flow-conventional,
        .circuit-active .flow-electron {
            opacity: 1;
        }

        /* --- Lamp Glow --- */
        .lamp-glow {
            fill: #475569; /* Off color */
            filter: drop-shadow(0 0 0px #f59e0b);
            transition: all 0.2s ease;
        }
        
        /* --- Switch Animation (Knife Switch) --- */
        #switch-blade-group {
            transform-origin: -30px 0px; /* Pivot point set explicitly at the left terminal (-30, 0) */
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .knife-blade-el {
            fill: #94a3b8;
            stroke: #475569;
            stroke-width: 2;
        }
        .switch-open#switch-blade-group {
            transform: rotate(-35deg);
        }
        .switch-closed#switch-blade-group {
            transform: rotate(0deg);
        }

        /* --- Custom Range Slider (Ensures thumb is visible) --- */
        .range-styled {
            -webkit-appearance: none;
            background: transparent;
            height: 12px; /* Make track slightly thicker */
        }
        .range-styled:focus {
            outline: none;
        }

        /* WebKit (Chrome/Safari) thumb */
        .range-styled::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: currentColor; /* Use accent color from Tailwind */
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            margin-top: -4px; /* Adjust vertical position to center on track */
        }

        /* Mozilla (Firefox) thumb */
        .range-styled::-moz-range-thumb {
            height: 20px;
            width: 20px;
            border: none; /* Override default Firefox border */
            border-radius: 50%;
            background: currentColor;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen flex flex-col items-center p-4 md:p-8">

    <!-- Header -->
    <header class="mb-6 text-center w-full max-w-5xl">
        <h1 class="text-3xl md:text-4xl font-bold text-slate-900 mb-2">Electric Circuit Simulator</h1>
        <p class="text-slate-600">S.2 Science | Topic: V = IR Relationship</p>
    </header>

    <div class="w-full max-w-6xl grid grid-cols-1 lg:grid-cols-12 gap-6">

        <!-- LEFT PANEL: Controls & Calculations (4 cols) -->
        <div class="lg:col-span-4 space-y-4 flex flex-col">
            
            <!-- Controls Card -->
            <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 space-y-6">
                <h2 class="font-bold text-lg text-slate-800 border-b border-slate-100 pb-2">Controls Panel (控制面板)</h2>
                
                <!-- Battery Voltage Slider -->
                <div>
                    <label class="flex justify-between text-sm font-semibold text-slate-600 mb-2">
                        Battery Voltage (V) (電池電壓)
                        <span id="display-voltage" class="text-blue-600">3.0 V</span>
                    </label>
                    <input type="range" id="slider-voltage" min="1.5" max="12.0" step="0.5" value="3.0"
                           class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-600 range-styled">
                    <div class="flex justify-between text-xs text-slate-400 mt-1">
                        <span>1.5V</span>
                        <span>12V</span>
                    </div>
                </div>

                <!-- Rheostat Slider -->
                <div>
                    <label class="flex justify-between text-sm font-semibold text-slate-600 mb-2">
                        Rheostat Resistance (Ω) (可變電阻阻值)
                        <span id="display-rheostat" class="text-indigo-600">5.0 Ω</span>
                    </label>
                    <input type="range" id="slider-rheostat" min="0" max="20" step="1" value="5"
                           class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-600 range-styled">
                    <div class="flex justify-between text-xs text-slate-400 mt-1">
                        <span>0Ω</span>
                        <span>20Ω</span>
                    </div>
                </div>
                
                <!-- Circuit Switch Button (Alternative Control) -->
                <button onclick="toggleCircuit()" id="btn-switch" 
                        class="w-full py-3 px-4 rounded-xl font-bold text-white transition-all transform active:scale-95 shadow-lg bg-red-500 hover:bg-red-600">
                    Turn ON Circuit (開啟電路)
                </button>
            </div>

            <!-- Calculation Card -->
            <div class="bg-slate-900 text-white rounded-2xl shadow-lg p-6">
                <h2 class="font-bold text-lg text-slate-200 border-b border-slate-700 pb-2 mb-4">Ohm's Law Calculation (歐姆定律計算)</h2>
                
                <div class="space-y-4 font-mono text-sm md:text-base">
                    <!-- Formula -->
                    <div class="text-center p-2 bg-slate-800 rounded-lg text-yellow-400 font-bold text-xl">
                        I = V / R<sub>total</sub>
                    </div>

                    <!-- Steps -->
                    <div class="space-y-2">
                        <div class="flex justify-between items-center border-b border-slate-800 pb-1">
                            <span class="text-slate-400">Total Resistance (R<sub>t</sub>) (總電阻)</span>
                            <span>
                                <span class="text-indigo-400" id="calc-rheostat">5.0</span> + 
                                <span class="text-slate-400" title="Fixed Lamp Resistance">10.0</span> = 
                                <span class="font-bold" id="calc-rtotal">15.0</span> Ω
                            </span>
                        </div>
                        <div class="flex justify-between items-center border-b border-slate-800 pb-1">
                            <span class="text-slate-400">Voltage (V) (電壓)</span>
                            <span class="font-bold text-blue-400" id="calc-voltage">3.0</span> V
                        </div>
                        <div class="flex justify-between items-center pt-2">
                            <span class="text-slate-400">Current (I) (電流)</span>
                            <span class="text-green-400 font-bold text-xl">
                                <span id="calc-current">0.20</span> A
                            </span>
                        </div>
                    </div>
                </div>
                <p class="text-xs text-slate-500 mt-4 text-center">
                    *Lamp is treated as a fixed resistor (10Ω). (燈泡視為固定電阻 10Ω)
                </p>
            </div>

        </div>

        <!-- RIGHT PANEL: Circuit Visualization (8 cols) -->
        <div class="lg:col-span-8 bg-white rounded-2xl shadow-xl border border-slate-200 overflow-hidden relative flex flex-col">
            
            <!-- Legend Bar -->
            <div class="bg-slate-50 p-3 border-b border-slate-100 flex flex-wrap gap-4 text-xs justify-center md:justify-start">
                 <div class="flex items-center gap-2">
                    <div class="w-3 h-3 rounded-full bg-blue-500"></div>
                    <span class="font-semibold text-slate-600">Conventional Current Flow (慣用電流方向)</span>
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-3 h-3 rounded-full bg-red-500"></div>
                    <span class="font-semibold text-slate-600">Electron Flow (電子流方向)</span>
                </div>
                <div class="flex items-center gap-2 ml-auto">
                    <span class="font-semibold text-slate-500">Fixed Lamp Resistance R: 10Ω</span>
                </div>
            </div>

            <!-- SVG Container -->
            <div class="flex-1 relative bg-slate-50 p-4 flex items-center justify-center">
                <!-- ViewBox height 540 -->
                <svg id="circuit-svg" class="w-full h-full max-h-[540px]" viewBox="0 0 800 540" preserveAspectRatio="xMidYMid meet">
                    
                    <!-- --- 1. WIRING (主電路) --- -->
                    <path d="M 100 250 L 100 80 L 700 80 L 700 420 L 100 420 L 100 250" 
                          fill="none" stroke="#cbd5e1" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/>

                    <!-- Voltmeter connection path (Parallel to Lamp) -->
                    <!-- Path Y coordinate at 510 -->
                    <path d="M 300 420 L 300 510 L 500 510 L 500 420" 
                          fill="none" stroke="#94a3b8" stroke-width="2" />
                    
                    <!-- Junction Dots (Make connections clear) -->
                    <circle cx="300" cy="420" r="5" fill="#334155" stroke="#cbd5e1" stroke-width="1.5"/>
                    <circle cx="500" cy="420" r="5" fill="#334155" stroke="#cbd5e1" stroke-width="1.5"/>

                    <!-- --- 2. FLOW ANIMATION PATHS --- -->
                    <path id="flow-path-conv" 
                          d="M 100 250 L 100 80 L 700 80 L 700 420 L 100 420 L 100 250" 
                          fill="none" stroke="#3b82f6" stroke-width="6" 
                          class="flow-conventional opacity-0" />
                    
                    <path id="flow-path-elec" 
                          d="M 100 250 L 100 80 L 700 80 L 700 420 L 100 420 L 100 250" 
                          fill="none" stroke="#ef4444" stroke-width="3" 
                          class="flow-electron opacity-0" 
                          style="stroke-dasharray: 2 18;" />

                    <!-- --- 3. COMPONENTS --- -->

                    <!-- Battery (電池) -->
                    <g transform="translate(100, 250)">
                        <rect x="-25" y="-35" width="50" height="70" fill="#f8fafc" />
                        <line x1="-20" y1="-15" x2="20" y2="-15" stroke="#334155" stroke-width="4" />
                        <line x1="-10" y1="15" x2="10" y2="15" stroke="#334155" stroke-width="4" />
                        <line x1="-20" y1="25" x2="20" y2="25" stroke="#334155" stroke-width="4" />
                        <line x1="-10" y1="-5" x2="10" y2="-5" stroke="#334155" stroke-width="4" />
                        <text x="-35" y="-10" font-weight="bold" fill="#334155" font-size="16">+</text>
                        <text x="-35" y="30" font-weight="bold" fill="#334155" font-size="16">-</text>
                        <text x="-50" y="5" font-size="14" font-weight="bold" fill="#2563eb" text-anchor="end" id="svg-battery-label">3.0 V</text>
                        <text x="-50" y="-25" font-size="12" fill="#64748b" text-anchor="end">Battery</text>
                    </g>

                    <!-- Switch (開關) -->
                    <g transform="translate(250, 80)" class="cursor-pointer" onclick="toggleCircuit()">
                        <rect x="-50" y="-40" width="100" height="80" fill="transparent" />
                        <rect x="-40" y="-5" width="80" height="10" rx="2" fill="#e2e8f0" />
                        <circle cx="-30" cy="0" r="4" fill="#334155" />
                        <circle cx="30" cy="0" r="4" fill="#334155" />
                        
                        <!-- Switch Blade Group: Rotation applied here, pivoting at the left terminal (-30, 0) -->
                        <g id="switch-blade-group" class="switch-open">
                            <!-- Blade starts at -30 (the pivot) and extends right -->
                            <rect class="knife-blade-el" x="-30" y="-3" width="65" height="6" rx="1" />
                            <!-- Contact tip at the end of the blade: -30 + 65 = 35 -->
                            <circle class="knife-blade-el" cx="35" cy="0" r="3" fill="#ef4444" stroke="none" />
                        </g>

                        <text x="0" y="-25" text-anchor="middle" font-size="12" fill="#64748b" font-weight="bold">Switch (開關)</text>
                    </g>

                    <!-- Rheostat (可變電阻) -->
                    <g transform="translate(550, 80)">
                        <rect x="-40" y="-20" width="80" height="40" fill="#f8fafc" />
                        <path d="M -30 0 L -20 -10 L -10 10 L 0 -10 L 10 10 L 20 -10 L 30 0" 
                              fill="none" stroke="#334155" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                        <g id="rheostat-wiper" transform="translate(0,0)">
                            <line x1="0" y1="-25" x2="0" y2="-12" stroke="#4f46e5" stroke-width="3" marker-end="url(#arrowhead)" />
                            <polygon points="-5,-25 5,-25 0,-12" fill="#4f46e5" />
                        </g>
                        <text x="0" y="-35" text-anchor="middle" font-size="12" fill="#4f46e5" font-weight="bold">Rheostat (可變電阻)</text>
                        <text x="0" y="25" text-anchor="middle" font-size="12" fill="#64748b" id="svg-rheostat-label">5 Ω</text>
                    </g>

                    <!-- Ammeter (安培計) -->
                    <g transform="translate(700, 250)">
                        <circle cx="0" cy="0" r="28" fill="#fff" stroke="#334155" stroke-width="3" />
                        <text x="0" y="5" text-anchor="middle" font-size="20" font-weight="bold" fill="#334155">A</text>
                        <!-- Digital readout frame for Ammeter: width is 60, centered at -75 -->
                        <rect x="-55" y="-15" width="60" height="30" rx="4" fill="#1e293b" transform="translate(-50, 0)"/>
                        <text id="ammeter-text" x="-75" y="5" text-anchor="middle" font-family="monospace" font-size="14" fill="#22c55e">0.2 A</text>
                        <text x="-110" y="5" font-size="12" fill="#64748b" text-anchor="end">Ammeter</text>
                    </g>

                    <!-- Lamp (燈泡) -->
                    <g transform="translate(400, 420)">
                        <circle id="lamp-bulb" cx="0" cy="0" r="30" class="lamp-glow" stroke="#334155" stroke-width="2" fill="#e2e8f0"/>
                        <path d="M -15 -15 L 15 15 M 15 -15 L -15 15" stroke="#475569" stroke-width="2" />
                        <text x="0" y="50" text-anchor="middle" font-size="12" fill="#64748b">Lamp (燈泡) (10Ω)</text>
                    </g>

                    <!-- Voltmeter (伏特計) -->
                    <!-- Group position at 510 -->
                    <g transform="translate(400, 510)">
                        <circle cx="0" cy="0" r="20" fill="#fff" stroke="#334155" stroke-width="2" />
                        <text x="0" y="5" text-anchor="middle" font-size="16" font-weight="bold" fill="#334155">V</text>
                         <!-- Digital readout frame for Voltmeter -->
                         <rect x="25" y="-12" width="70" height="24" rx="4" fill="#1e293b" />
                         <!-- Text position adjusted to be centered in the wider rectangle -->
                         <text id="voltmeter-text" x="60" y="5" text-anchor="middle" font-family="monospace" font-size="12" fill="#fbbf24">2.0 V</text>
                         <text x="110" y="5" font-size="12" fill="#64748b" text-anchor="start">Voltmeter</text>
                    </g>

                </svg>
            </div>
        </div>

    </div>

    <script>
        // --- Constants ---
        const LAMP_RESISTANCE = 10.0;
        
        // --- State ---
        let state = {
            voltage: 3.0,
            rheostat: 5.0,
            isClosed: false,
            current: 0.20 // Calculated later
        };

        // --- DOM Elements ---
        const els = {
            sliderV: document.getElementById('slider-voltage'),
            sliderR: document.getElementById('slider-rheostat'),
            displayV: document.getElementById('display-voltage'),
            displayR: document.getElementById('display-rheostat'),
            svgV: document.getElementById('svg-battery-label'),
            svgR: document.getElementById('svg-rheostat-label'),
            wiper: document.getElementById('rheostat-wiper'),
            btnSwitch: document.getElementById('btn-switch'),
            bladeGroup: document.getElementById('switch-blade-group'),
            circuitSvg: document.getElementById('circuit-svg'),
            lampBulb: document.getElementById('lamp-bulb'),
            ammeter: document.getElementById('ammeter-text'),
            voltmeter: document.getElementById('voltmeter-text'),
            calcRheostat: document.getElementById('calc-rheostat'),
            calcRTotal: document.getElementById('calc-rtotal'),
            calcVoltage: document.getElementById('calc-voltage'),
            calcCurrent: document.getElementById('calc-current')
        };

        // --- Logic ---
        function updateCalculations() {
            state.voltage = parseFloat(els.sliderV.value);
            state.rheostat = parseFloat(els.sliderR.value);

            const totalResistance = state.rheostat + LAMP_RESISTANCE;
            const current = state.voltage / totalResistance;
            state.current = current;
            // The voltage across the lamp (V = I * R_lamp)
            const lampVoltage = current * LAMP_RESISTANCE;

            // Update display values (sliders and SVG labels)
            els.displayV.textContent = state.voltage.toFixed(1) + " V";
            els.displayR.textContent = state.rheostat.toFixed(1) + " Ω";
            els.svgV.textContent = state.voltage.toFixed(1) + " V";
            els.svgR.textContent = state.rheostat.toFixed(1) + " Ω";

            // Update calculation panel
            els.calcRheostat.textContent = state.rheostat.toFixed(1);
            els.calcRTotal.textContent = totalResistance.toFixed(1);
            els.calcVoltage.textContent = state.voltage.toFixed(1);
            els.calcCurrent.textContent = current.toFixed(2);

            // Update circuit state (ammeter, voltmeter, lamp)
            if (state.isClosed) {
                // Ammeter and Voltmeter readings are displayed in their frames
                els.ammeter.textContent = current.toFixed(2) + " A";
                // Voltmeter displays voltage across the lamp
                els.voltmeter.textContent = lampVoltage.toFixed(1) + " V";
                
                // Control lamp brightness based on current
                const brightness = Math.min(Math.max(current * 0.8, 0.1), 1.0);
                const glowSize = Math.min(current * 30, 50);
                
                els.lampBulb.style.fill = "#fbbf24";
                els.lampBulb.style.filter = `drop-shadow(0 0 ${glowSize}px #f59e0b)`;
                els.lampBulb.style.opacity = brightness + 0.2;
            } else {
                els.ammeter.textContent = "0.00 A";
                els.voltmeter.textContent = "0.0 V";
                els.lampBulb.style.fill = "#e2e8f0";
                els.lampBulb.style.filter = "none";
                els.lampBulb.style.opacity = 1;
            }

            // Update rheostat wiper position
            const percent = state.rheostat / 20;
            const xPos = -30 + (percent * 60);
            els.wiper.setAttribute('transform', `translate(${xPos}, 0)`);
        }

        function toggleCircuit() {
            state.isClosed = !state.isClosed;
            if (state.isClosed) {
                els.bladeGroup.classList.remove('switch-open');
                els.bladeGroup.classList.add('switch-closed');
                els.btnSwitch.textContent = "Turn OFF Circuit (關閉電路)";
                els.btnSwitch.classList.replace('bg-green-500', 'bg-red-500');
                els.btnSwitch.classList.replace('hover:bg-green-600', 'hover:bg-red-600');
                els.circuitSvg.classList.add('circuit-active');
            } else {
                els.bladeGroup.classList.remove('switch-closed');
                els.bladeGroup.classList.add('switch-open');
                els.btnSwitch.textContent = "Turn ON Circuit (開啟電路)";
                els.btnSwitch.classList.replace('bg-red-500', 'bg-green-500');
                els.btnSwitch.classList.replace('hover:bg-red-600', 'hover:bg-green-600');
                els.circuitSvg.classList.remove('circuit-active');
            }
            updateCalculations();
        }

        // --- Event Listeners ---
        els.sliderV.addEventListener('input', updateCalculations);
        els.sliderR.addEventListener('input', updateCalculations);

        // --- Init ---
        // Ensure initial button state is correct
        els.btnSwitch.classList.add('bg-green-500', 'hover:bg-green-600'); 
        els.btnSwitch.classList.remove('bg-red-500'); 
        els.btnSwitch.classList.remove('hover:bg-red-600'); 
        updateCalculations();

    </script>
    
    <!-- Footer -->
    <footer class="bg-slate-900 text-slate-400 py-8 text-center">
        <div class="max-w-7xl mx-auto px-4">
            <p class="text-sm italic mb-2">But God made the earth by his power;<br>
            he founded the world by his wisdom<br>
            and stretched out the heavens by his understanding.</p>
            <p class="text-sm mb-2">Jeremiah 10:12</p>
            <p class="text-xs mb-2 mt-4">「耶和華用能力創造大地，用智慧建立世界，用聰明鋪張穹蒼。」</p>
            <p class="text-xs mb-4">耶利米書 10:12</p>
            <p class="text-xs mt-4 pt-4 border-t border-slate-700">@ 2025 Generated by Gemini Pro 3.0  Prepared by SF Lau</p>
        </div>
    </footer>
</body>
</html>

        <div class="max-w-7xl mx-auto px-4">
            <p class="text-sm italic mb-2">But God made the earth by his power;<br>
            he founded the world by his wisdom<br>
            and stretched out the heavens by his understanding.</p>
            <p class="text-sm mb-2">Jeremiah 10:12</p>
            <p class="text-xs mb-2 mt-4">「耶和華用能力創造大地，用智慧建立世界，用聰明鋪張穹蒼。」</p>
            <p class="text-xs mb-4">耶利米書 10:12</p>
            <p class="text-xs mt-4 pt-4 border-t border-slate-700">@ 2025 Generated by Gemini Pro 3.0  Prepared by SF Lau</p>
        </div>
    </footer>
</body>
</html>

        <div class="max-w-7xl mx-auto px-4">
            <p class="text-sm italic mb-2">But God made the earth by his power;<br>
            he founded the world by his wisdom<br>
            and stretched out the heavens by his understanding.</p>
            <p class="text-sm mb-2">Jeremiah 10:12</p>
            <p class="text-xs mb-2 mt-4">「耶和華用能力創造大地，用智慧建立世界，用聰明鋪張穹蒼。」</p>
            <p class="text-xs mb-4">耶利米書 10:12</p>
            <p class="text-xs mt-4 pt-4 border-t border-slate-700">@ 2025 Generated by Gemini Pro 3.0  Prepared by SF Lau</p>
        </div>
    </footer>
</body>
</html>

        <div class="max-w-7xl mx-auto px-4">
            <p class="text-sm italic mb-2">But God made the earth by his power;<br>
            he founded the world by his wisdom<br>
            and stretched out the heavens by his understanding.</p>
            <p class="text-sm mb-2">Jeremiah 10:12</p>
            <p class="text-xs mb-2 mt-4">「耶和華用能力創造大地，用智慧建立世界，用聰明鋪張穹蒼。」</p>
            <p class="text-xs mb-4">耶利米書 10:12</p>
            <p class="text-xs mt-4 pt-4 border-t border-slate-700">@ 2025 Generated by Gemini Pro 3.0  Prepared by SF Lau</p>
        </div>
    </footer>
</body>
</html>

        <div class="max-w-7xl mx-auto px-4">
            <p class="text-sm italic mb-2">But God made the earth by his power;<br>
            he founded the world by his wisdom<br>
            and stretched out the heavens by his understanding.</p>
            <p class="text-sm mb-2">Jeremiah 10:12</p>
            <p class="text-xs mb-2 mt-4">「耶和華用能力創造大地，用智慧建立世界，用聰明鋪張穹蒼。」</p>
            <p class="text-xs mb-4">耶利米書 10:12</p>
            <p class="text-xs mt-4 pt-4 border-t border-slate-700">@ 2025 Generated by Gemini Pro 3.0  Prepared by SF Lau</p>
        </div>
    </footer>
</body>
</html>
